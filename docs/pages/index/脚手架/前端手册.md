<!--
 * @Author: wangzhichiao<https://github.com/wzc570738205>
 * @Date: 2020-11-27 09:03:22
 * @LastEditors: wangzhichiao<https://github.com/wzc570738205>
 * @LastEditTime: 2020-12-18 16:57:47
-->


## 项目设置
```
npm install //不推荐cnpm
```

### 编译和热重载 开发环境

```
npm run serve
```

### 编译和压缩 生产环境

```
npm run build
```
### 本地代理配置

```js
...
...
  devServer: {
    ...
    proxy: {
     //代理的path需要和后端的server path一致或者为父级path，不然会导致set cookie因为作用域问题设置失败
     '/common-backend': {
        target: `http://47.105.123.78:8089/`,
        changeOrigin: true
      }
    }
  }
...
...
```

### 启动问题

- [node-sass 报错](https://github.com/PanJiaChen/vue-element-admin/issues/24#issuecomment-454057188)


安装失败的原因是node-sass下载的地址不对，
正确的地址是在这个目录下：`https://github.com/sass/node-sass/releases
而非https://github.com/sass/node-sass/releases/download/v4.11.0/win32-x64-59_binding.node`
但是如果不翻墙还是很难下载下来。

安装时指定镜像源
```
npm i node-sass --sass_binary_site=https://npm.taobao.org/mirrors/node-sass
```

## 风格配置

配置文件位于`src/settings.js`
| 参数 | 释义 | 取值 | 默认值 | 其他 | 
| ---------- | ---------------- | ------- | ------ | ------ |
| title | 项目名称 | String | '中电兴发后台管理系统' | 
| showSettings | 是否显示设置按钮 | Boolean | true | 
| fixedHeader | 是否固定header | Boolean | true | 
| sidebarLogo | 是否需要logo | Boolean | true | 
| tagsView | 是否需要tagsView | Boolean | false | 
| needFooter | 是否需要footer | Boolean | false | 
| fixedFooter | 是否固定footer  | Boolean | false | 注意；开启后会默认固定头部|
| loginView | 登录风格 | 'one'/'two' | 'two' | 
| navBarMode | 导航风格 | 'vertical'/'horizontal' | 'vertical' | 

## 内置模块
- 登录模块
- 菜单管理
- 角色管理
- 用户管理
- 字典管理
- 部门管理
- 参数管理
- 日志管理

## 路由配置

路由配置文件`src/router/index.js`

`constantRouterMap`不需要权限的路由

`asyncRouterMap`需要权限进行动态的路由

具体参数
```js
注意：子菜单仅在路由children.length> = 1时出现
// 当设置 true 的时候该路由不会在侧边栏出现 如401，login等页面，或者如一些编辑页面/edit/1
hidden: true // (默认 false)

//当设置 noRedirect 的时候该路由在面包屑导航中不可被点击
redirect: 'noRedirect'

// 当你一个路由下面的 children 声明的路由大于1个时，自动会变成嵌套的模式--如组件页面
// 只有一个时，会将那个子路由当做根路由显示在侧边栏--如引导页面
// 若你想不管路由下面的 children 声明的个数都显示你的根路由
// 你可以设置 alwaysShow: true，这样它就会忽略之前定义的规则，一直显示根路由
alwaysShow: true
menu：                       //对应的菜单权限标识码 
name: 'router-name' // 设定路由的名字，一定要填写不然使用<keep-alive>时会出现各种问题
meta: {
  roles: ['admin', 'editor'] // 设置该路由进入的权限，支持多个权限叠加
  title: 'title' // 设置该路由在侧边栏和面包屑中展示的名字
  icon: 'svg-name' // 设置该路由的图标，支持 svg-class，也支持 el-icon-x element-ui 的 icon
  noCache: true // 如果设置为true，则不会被 <keep-alive> 缓存(默认 false)
  breadcrumb: false //  如果设置为false，则不会在breadcrumb面包屑中显示(默认 true)
  affix: true // 若果设置为true，它则会固定在tags-view中(默认 false)

  // 当路由设置了该属性，则会高亮相对应的侧边栏。
  // 这在某些场景非常有用，比如：一个文章的列表页路由为：/article/list
  // 点击文章进入文章详情页，这时候路由为/article/1，但你想在侧边栏高亮文章列表的路由，就可以进行如下设置
  activeMenu: '/article/list'
}
```

## 权限配置
### 菜单权限配置
按钮权限配置需要在`菜单管理`页面配置对应的菜单功能

比如`用户管理`的路由`menu`代码中写为`user`
```js
const userRouter = {
  .....
  children: [
    {
      path: 'user',
      name: '用户列表',
      component: () => import('@/views/user/user'),
      meta: { title: '用户列表', icon: '用户管理' },
      menu: 'user'
    }
    ......
  ]
}
```
则菜单管理中`用户列表`项的`标识码`填写`user`
### 按钮权限配置

比如`用户列表`中有`新增`、`编辑`、`删除`按钮

在页面`按钮功能`新建
| 按钮名称 | 标识码 | 
| ---------- | ---------------- | 
| 新增 | user:add | 
| 编辑 | user:update | 
| 删除 | user:delete | 

在`user.vue`中填写
```html
<el-button v-if="hasPerm('user:add')" type="primary">添加</el-button>
<el-button v-if="hasPerm('user:update')" type="primary">编辑</el-button>
<el-button v-if="hasPerm('user:delete')" type="primary">删除</el-button>
```


## 环境变量

[官方文档](https://cli.vuejs.org/zh/guide/mode-and-env.html)
```
.env                # 在所有的环境中被载入
.env.[mode]         # 只在指定的模式中被载入
```
一个环境文件只包含环境变量的“键=值”对：
```
FOO=bar
VUE_APP_SECRET=secret
```
::: tip 注意！！！

环境变量必须以VUE_APP_为开头。如:VUE_APP_API、VUE_APP_TITLE

你在代码中可以通过如下方式获取:
```
console.log(process.env.VUE_APP_xxxx)
```
:::

除了 `VUE_APP_*` 变量之外，在你的应用代码中始终可用的还有两个特殊的变量：

- `NODE_ENV` - 会是 "development"、"production" 或 "test" 中的一个。具体的值取决于应用运行的模式。
- `BASE_URL` - 会和 vue.config.js 中的 publicPath 选项相符，即你的应用会部署到的基础路径。
#构建相关
除了一些写在.env的环境变量之外，还有一些构建和部署相关的变量都是需要在vue.config.js中配置的。

你可以通过`process.env.NODE_ENV`来执行判断环境，来设置不同的参数。

具体代码可借鉴[vue.config.js](https://github.com/PanJiaChen/vue-element-admin/blob/master/vue.config.js)



## 新增页面

如果熟悉 `vue-router` 的配置就很简单了。

首先在 `@/router/index.js` 中增加你需要添加的路由。

**如：新增一个 excel 页面**

```js
{
  path: '/excel',
  component: Layout,
  redirect: '/excel/export-excel',
  name: 'excel',
  meta: {
    title: 'excel',
    icon: 'excel'
  }
}
```

::: tip
仅仅这样不会有任何效果的，它只是创建了一个基于`layout`的一级路由，你还需要在它下面的 `children` 中添加子路由。
:::

```js
{
  path: '/excel',
  component: Layout,
  redirect: '/excel/export-excel',
  name: 'excel',
  meta: {
    title: 'excel',
    icon: 'excel'
  },
  children: [
    {
      path: 'export-excel',
      component: ()=>import('excel/exportExcel'),
      name: 'exportExcel',
      meta: { title: 'exportExcel' }
    }
  ]
}
```

**这样侧边栏就会出现如图所示的 `menu-item` 了**

![](https://panjiachen.gitee.io/gitee-cdn/vue-element-admin-site/2ab6921d-f9bb-4fbb-a151-0e6027e23a6e.png)

<br/>

::: tip
由于 `children` 下面只声明了一个路由所以不会有展开箭头，如果`children`下面的路由个数大于 1 就会有展开箭头，如下面所示。
如果你想忽视这个自动判断可以使用 `alwaysShow: true`，这样它就会忽略之前定义的规则，一直显示根路由。详情见[路由和侧边栏](/zh/guide/essentials/router-and-nav.html#路由和侧边栏)
:::

```js
{
  path: '/excel',
  component: Layout,
  redirect: '/excel/export-excel',
  name: 'excel',
  meta: {
    title: 'excel',
    icon: 'excel'
  },
  children: [
    { path: 'export-excel', component: ()=>import('excel/exportExcel'), name: 'exportExcel', meta: { title: 'exportExcel' }},
    { path: 'export-selected-excel', component: ()=>import('excel/selectExcel'), name: 'selectExcel', meta: { title: 'selectExcel' }},
    { path: 'upload-excel', component: ()=>import('excel/uploadExcel'), name: 'uploadExcel', meta: { title: 'uploadExcel' }}
  ]
}
```

![](https://panjiachen.gitee.io/gitee-cdn/vue-element-admin-site/89d6a0b8-5cf7-4a19-9afd-7267ec454066.png)

**侧边栏就会出现如图所示的 `submenu` 了**

<br/>

### 新增 view

新增完路由之后不要忘记在 `@/views` 文件下 创建对应的文件夹，一般性一个路由对应一个文件，该模块下的功能组件或者方法就建议在本文件夹下创建一个`utils`或`components`文件夹，各个功能模块维护自己的`utils`或`components`组件。如：

![](https://panjiachen.gitee.io/gitee-cdn/vue-element-admin-site/8ca55a30-c22c-4143-aa8d-2a0d3e04fc33.png)

<br/>

### 新增 api

最后在 `@/api`文件夹下创建本模块对应的 api 服务。

### 新增组件

在全局的 `@/components` 只会写一些全局的组件，如富文本，各种搜索组件，封装的日期组件等等能被公用的组件。每个页面或者模块特定的业务组件则会写在当前 views 下面。如：`@/views/article/components/xxx.vue`。这样拆分大大减轻了维护成本。

**请记住拆分组件最大的好处不是公用而是可维护性！**

### 新增样式

页面的样式和组件是一个道理，全局的 `@/style` 放置一下全局公用的样式，每一个页面的样式就写在当前 `views`下面，请记住加上`scoped` 或者命名空间，避免造成全局的样式污染。

```css
<style>
/* global styles */
</style>

<style scoped>
/* local styles */
.xxx-container{
  /* name scoped */
  xxx
}
</style>
```
## ESLint

不管是多人合作还是个人项目，代码规范都是很重要的。这样做不仅可以很大程度地避免基本语法错误，也保证了代码的可读性。

### 配置项

所有的配置文件都在 [.eslintrc.js](https://github.com/PanJiaChen/vue-element-admin/blob/master/.eslintrc.js) 中。
本项目基本规范是依托于 vue 官方的 eslint 规则 [eslint-config-vue](https://github.com/vuejs/eslint-config-vue) 做了少许的修改。

```js
module.exports = {
  root: true,
  env: {
    node: true
  },
  extends: ['plugin:vue/essential', 'eslint:recommended', '@vue/prettier'],
  parserOptions: {
    parser: 'babel-eslint'
  },
  plugins: ['prettier'],
  rules: {
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-async-promise-executor': 0,
    'prettier/prettier': 'error'
  }
}
```

### vscode 配置 ESLint

这所谓工欲善其事，必先利其器，推荐 eslint+vscode+prettier 来写 vue，绝对有种飞一般的感觉。效果如图：
![eslintGif.gif](https://panjiachen.gitee.io/gitee-cdn/vue-element-admin-site/e94a76df-6dc0-4c15-9785-28b553a163e9.png)

<br/>

每次保存，vscode 就能标红不符合 eslint 规则的地方，同时还会做一些简单的自我修正。安装步骤如下：

首先安装 eslint 插件
![eslint1.png](https://panjiachen.gitee.io/gitee-cdn/vue-element-admin-site/72f126cb-09eb-4b27-b02e-65e79eb76220.png)

安装并配置完成 ESLint 后，我们继续回到 VSCode 进行扩展设置，依次点击 文件 > 首选项 > 设置 打开 VSCode 配置文件,添加如下配置

```json
{
  "files.autoSave": "off",
  "eslint.validate": [
    "javascript",
    "javascriptreact",
    "vue-html",
    {
      "language": "vue",
      "autoFix": true
    }
  ],
  "eslint.run": "onSave",
  "eslint.autoFixOnSave": true
}
```

这样每次保存的时候就可以根据根目录下.eslintrc.js 你配置的 eslint 规则来检查和做一些简单的 fix。

[vscode 插件和配置推荐](https://github.com/varHarrie/Dawn-Blossoms/issues/10)

### 更多配置

由于本项目是基于`vue-cli`进行构建，所以更多配置可参考官方[文档](https://cli.vuejs.org/zh/config/#lintonsave)

### 自动修复

```bash
npm run lint -- --fix
```

运行如上命令，eslint 会自动修复一些简单的错误。

## Git Hooks

具备基本工程素养的同学都会注重编码规范，而代码风格检查（Code Linting，简称 Lint）是保障代码规范一致性的重要手段。

使用 `Lint` 会有什么好处呢？在我看来至少具有如下 3 点：

- 更少的 Bug
- 更高的开发效率，Lint 很容易发现低级的、显而易见的错误
- 更高的可读性

很多时候我们`lint`的校验是放在持续集成阶段，大概流程如下：

> 代码提交 --> 跑 CI 发现问题(远程) --> 本地修复问题 --> 重新提交 --> 通过检查(远程)

但这样有一个问题，我们的 `CI`(持续集成) 往往不是仅仅只做 `Lint`工作，它还有会有很多其它的任务（如打包文件，静态资源上传 CDN 等），这样就导致特别的浪费时间，往往可能需要几分钟之后你才会发现问题，或者有的时候你根本就没有发现你的 `CI` 没有跑通过。

常见的流程：本地写好了代码，提交，开始跑 lint，发现不通过，本地修改代码，再提交，再等待 CI 的结果，若还有问题再重复之前的操作。

### husky

最有效的解决方案就是将 `Lint` 校验放到本地，常见做法是使用 [husky](https://github.com/typicode/husky) 或者 [pre-commit](https://github.com/observing/pre-commit) 在本地提交之前先做一次 `Lint`校验。

> 当然如果你创建项目的时候使用了 `vue-cli@3`，你也可以使用它内置的 [yorkie](https://github.com/yyx990803/yorkie)，它是基于`husky`的，但稍微改了一下接口。不过这里我们还是选用 `husky`作为例子。

```bash
npm install husky -D -S
```

然后修改 `package.json`，增加配置：

```json
"husky": {
    "hooks": {
      "pre-commit": "eslint --ext .js,.vue src"
    }
  }
```

最后尝试 `Git` 提交，你就会很快收到反馈：

```
git commit -m "Keep calm and commit"
```

但这样会有一个问题，就是这次提交，我可能只修改了一个文件，比如我就修改了 `foo.js` 的内容，但它依然会校验所有`src` 下面的`.js`文件，非常的不友好。导致的问题就是：每次我提交我写的代码，还先要帮人的代码问题解决了才能顺利提交，而且当项目大了之后，检查速度也会变得越来越慢了。

### lint-staged

解决上面的痛点就需要使用 [lint-staged](https://github.com/okonet/lint-staged) 了。它只会校验检查你提交或者说你修改的部分内容。

```bash
npm install lint-staged -D -S
```

然后，修改 package.json 配置：

```json
"husky": {
  "hooks": {
    "pre-commit": "lint-staged"
  }
},
"lint-staged": {
    "src/**/*.{js,vue}": [
      "eslint --fix",
      "git add"
    ]
  }
```

如上配置，每次它只会在你本地 `commit` 之前，校验你提交的内容是否符合你本地配置的 `eslint`规则(这个见文档 [ESLint](eslint.md) )，如果符合规则，则会提交成功。如果不符合它会自动执行 `eslint --fix` 尝试帮你自动修复，如果修复成功则会帮你把修复好的代码提交，如果失败，则会提示你错误，让你修好这个错误之后才能允许你提交代码。

### 总结

最佳的 `lint` 规范流程就是推荐团队成员先在自己的编辑器中配置 `eslint`，在 webpack 中配置并开启 `eslint-loader` 错误提示，这样平时写的时候编辑器就能帮你修正一些简单的格式错误，同时提醒你有哪些不符合 `lint` 规范的的地方，并在命令行中提示你错误。这方面详细的内容见 [ESLint](eslint.md)。

但这并不是强制的，有些团队成员或者说刚来的实习生没有在编辑器中配置或者无视命令行中提示的错误，这时候就需要配置`pre-commit` 这种强制性校验的东西，保证所有提交到远程仓库的内容都是符合团队规范的。

## UI规范
[点击全屏查看](/tools/PC端设计组件规范说明.pdf)

[备用地址](https://gitee.com/Wzhichao/img/raw/master/uPic/PC%E7%AB%AF%E8%AE%BE%E8%AE%A1%E7%BB%84%E4%BB%B6%E8%A7%84%E8%8C%83%E8%AF%B4%E6%98%8E.pdf)

<ClientOnly>
  <PcStandard/>
</ClientOnly>

## 技术栈

[![](/tools/vue.png)](https://cn.vuejs.org/index.html)

[![](/tools/elementui.png)](https://cn.vuejs.org/index.html)

## 图标库

项目内置3种图标库
- [iChinaE iconFont](http://47.105.123.78:8066/icefont/)
```html
<i class="ice ice-add"></i>
```
- [Element Icon](https://element.eleme.cn/#/zh-CN/component/icon)
```html
<i class="el-icon-edit"></i>
```
- [Font Awesome](http://fontawesome.dashgame.com/)
```html
<i class="fa fa-bus"></i>
```
