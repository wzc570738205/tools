## 服务目的

-------

为业务系统提供统一登录登出服务，为了安全和降低耦合以及统一管理用户。

## 如何使用

-----

1、业务系统需要添加过滤逻辑，对接登录系统

2、 使用时要根据各系统不同，修改配置文件

3、 调用登录服务系统



## 登录服务

### 业务系统调用登录平台进行登录认证

- 登录服务
- 用户登录验证接口
- 服务校验服务
- 退出登录服务

## 业务流程说明

1、 认证平台注册用户，分配权限，用户状态

2、 业务系统调用登录验证接口进行验证

3、 如果验证失败则调用登录接口，如果登录成功则会系统调用服务校验服务，通过则认证成功

4、 如果服务校验服务调用返回失败，则调用登录服务进行登录

## 接口说明

### 一、 请求方式说明

- 现提供的接口可公国http,参数以及json格式发送请求
- 根据接口的不同，所传入的参数也不同
- 所传参数具体看对应的接口

### 二、 接口介绍

### 1、用户登录接口

**接口地址**:  `/sso/login`

**请求方式**：`POST`


**consumes**:`["application/json"]`

**produces**:`["*/*"]`

**请求示例**：

```json
post请求 -> http://127.0.0.1:8999/sso/login?server=http://www.baidu.com
再携带{"username":"admin","password":"123456"}
```

**请求参数**：

| 参数名称   | 参数说明   | in    | 是否必须 | 数据类型                   | schema                     |
| ---------- | ---------- | ----- | -------- | -------------------------- | -------------------------- |
| credential | credential | body  | false    | UsernamePasswordCredential | UsernamePasswordCredential |
| service    | 服务地址   | query | false    | string                     |                            |

**schema属性说明**



**UsernamePasswordCredential**

| 参数名称 | 参数说明 | in   | 是否必须 | 数据类型 | schema |
| -------- | -------- | ---- | -------- | -------- | ------ |
| id       |          | body | false    | string   |        |
| password | 密码     | body | false    | string   |        |
| username | 账号     | body | false    | string   |        |

**响应示例**

```json
{
    "state": 0,
    "message": "ok",
    "data": {
        "user_info": "{\"email\":\"123@qq.com\",\"id\":1,\"name\":\"管理员\",\"password\":\"\",\"phone\":\"13222222233\",\"status\":\"1\",\"type\":\"1\",\"username\":\"admin\"}"
    }
}
```

**响应参数**:


| 参数名称 | 参数说明                      | 类型           | schema         |
| -------- | ----------------------------- | -------------- | -------------- |
| data     | 返回数据(服务地址+st票据信息) | string         |                |
| message  |                               | string         |                |
| state    |                               | integer(int32) | integer(int32) |



### 2、用户登录验证接口

**接口地址**:`/sso/validate/login`


**请求方式**：`POST`


**consumes**:`["application/json"]`

**produces**:`["*/*"]`



**请求参数**：

| 参数名称               | 参数说明  | in    | 是否必须 | 数据类型 | schema |
| ---------------------- | --------- | ----- | -------- | -------- | ------ |
| service                | 服务地址  | query | true     | string   |        |
| ticketGrantingTicketId | tgt凭证id | query | true     | string   |        |

**请求示例**

```json
post请求 -> http://127.0.0.1:8999/sso/validate/login?service=http://www.baidu.com
```



**响应示例**:

```json
{
    "state": 0,
    "message": "ok",
    "data": "http://www.baidu.com?ticket=ST-3-zVbcRZUuIhJarLuMvNHXSU55dnawfk9UVxc-service"
}
```

**响应参数**:


| 参数名称 | 参数说明                      | 类型           | schema         |
| -------- | ----------------------------- | -------------- | -------------- |
| data     | 返回数据(服务地址+st票据信息) | string         |                |
| message  |                               | string         |                |
| state    |                               | integer(int32) | integer(int32) |

### 3、服务校验服务

**接口地址**:`/sso/service/validate`


**请求方式**：`POST`


**consumes**:`["application/json"]`

**produces**:`["*/*"]`



**请求示例：**

```json
post请求 -> http://127.0.0.1:8999/sso/service/validate?ticket=ST-1-oahCYjORm9b273Ykp9ftv6jJy4j67c25HbS-service&service=http://www.baidu.com
```



**请求参数**：

| 参数名称 | 参数说明 | in    | 是否必须 | 数据类型 | schema |
| -------- | -------- | ----- | -------- | -------- | ------ |
| ticket   | st票据   | query | true     | string   |        |
| service  | 服务地址 | query | true     | string   |        |

**响应示例**:

```json
{
    "state": 0,
    "message": "ok",
    "data": {
        "id": "admin",
        "attributes": {
            "userInfo": {
                "id": 1,
                "name": "管理员",
                "username": "admin",
                "password": "e10adc3949ba59abbe56e057f20f883e",
                "phone": "13222222233",
                "email": "123@qq.com",
                "type": "1",
                "status": "1",
                "createTime": 1608084253000,
                "createUser": "1",
                "updateTime": 1608803640000,
                "updateUser": "1",
                "lastLoginTime": 1608084265000
            }
        }
    }
}
```

**响应参数**:


| 参数名称 | 参数说明 | 类型           | schema         |
| -------- | -------- | -------------- | -------------- |
| data     | 返回数据 | Principal      | Principal      |
| message  | 返回信息 | string         |                |
| state    | 返回状态 | integer(int32) | integer(int32) |

### 4、 登出服务

**接口地址**:`/sso/logout`


**请求方式**：`POST`


**consumes**:`["application/json"]`

**produces**:`["*/*"]`



**请求示例：**

```json
post请求 -> http://127.0.0.1:8999/sso/logout
```



**请求参数**：
暂无



**响应示例**:

```json
{
    "state": 0,
    "message": "ok",
    "data": null
}
```

**响应参数**:


| 参数名称 | 参数说明 | 类型           | schema         |
| -------- | -------- | -------------- | -------------- |
| data     | 返回数据 | object         |                |
| message  | 返回信息 | string         |                |
| state    | 返回状态 | integer(int32) | integer(int32) |

